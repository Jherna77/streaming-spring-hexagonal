<html data-bs-theme="dark" lang="es"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header::header-css">
    <title th:text="#{app.title}"></title>
</head>
<body class="d-flex flex-column min-vh-100">
<header th:replace="fragments/header::header-admin"></header>
<main id="main">
    <section class="px-sm-3 bg-gradient-reverse" id="title">
        <div class="container-lg">
            <h2 class="m-4 text-center" th:text="#{app.statistics}"></h2>
        </div>
        <hr class="m-0 p-0">
    </section>

    <script th:each="chart : ${charts}" th:inline="javascript" type="text/javascript">
        google.charts.load('current', {'packages': ['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            const data = new google.visualization.DataTable();
            /*[# th:each="col : ${chart.cols}"]*/
            data.addColumn("[(${col.key})]", "[(${col.value})]");
            /*[/]*/
            data.addRows([[${chart.rows}]]);

            const bgColor = 'transparent';
            const textColor = 'white';
            const options = {
                title: '[[|#{${chart.title}}|]]'.replaceAll('"', ''),
                responsive: true,
                backgroundColor: bgColor,
                titleTextStyle: {color: textColor},
                hAxis: {textStyle: {color: textColor}, titleTextStyle: {color: textColor}},
                vAxis: {textStyle: {color: textColor}, titleTextStyle: {color: textColor}},
                legend: {textStyle: {color: textColor}}
            };
            const chart = new google.visualization.PieChart(document.getElementById([[${chart.id}]]));
            chart.draw(data, options);
        }

        $(window).resize(function () {
            drawChart();
        });
    </script>
    <section id="charts">
        <div class="container-fluid">
            <div class="row row-chart">
                <div class="col-md-4" th:each="chart : ${charts}">
                    <div class="chart" th:id="${chart.id}"></div>
                </div>
            </div>
        </div>
    </section>

    <section class="bg-gradient-reverse" id="history">
        <div class="container-lg">
            <div class="row-cols-1 pb-lg-2 ps-2">
                <h4 th:text="#{statistics.history.plays}"></h4>
                <hr>
            </div>
            <div class="row-cols-1">
                <div class="col-md-12 table-responsive card">
                    <table class="table table-striped table-hover table-dark">
                        <thead>
                        <tr>
                            <th class="btn-primary text-white" th:text="#{content.title}"/>
                            <th class="btn-primary text-white" th:text="#{content.type}"/>
                            <th class="btn-primary text-white" th:text="#{app.user}"/>
                            <th class="btn-primary text-white" th:text="#{app.date}"/>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="play : ${history}">
                            <td th:text="${play.content.title}"></td>
                            <td th:text="${play.content.type.name}"></td>
                            <td th:text="${play.user.email}"></td>
                            <td th:text="${#temporals.format(play.date, 'dd-MM-yyyy HH:mm:ss')}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <section class="bg-gradient" id="ratings">
        <br>
        <div class="container-lg">
            <div class="row-cols-1 pb-lg-2 ps-2">
                <h4 th:text="#{statistics.ratings}"></h4>
                <hr>
            </div>
            <div class="row-cols-1">
                <div class="col-md-12 table-responsive card">
                    <table class="table table-striped table-hover table-dark">
                        <thead>
                        <tr>
                            <th class="btn-primary text-white" th:text="#{content.title}"/>
                            <th class="btn-primary text-white" th:text="#{app.user}"/>
                            <th class="btn-primary text-white" th:text="#{rating.rate}"/>
                            <th class="btn-primary text-white" th:text="#{app.date}"/>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="rate : ${ratings}">
                            <td th:text="${rate.content.title}"></td>
                            <td th:text="${rate.user.email}"></td>
                            <td th:text="${rate.rating}"></td>
                            <td th:text="${#temporals.format(rate.date, 'dd-MM-yyyy HH:mm:ss')}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <br>
    </section>
    <br>

    <!-- Log out modal -->
    <div th:replace="fragments/header::modal-logout"></div>

    <script th:src="@{/js/main.js}"></script>
    <script th:src="@{/bootstrap/js/bootstrap.js}"></script>
</main>
<footer th:replace="fragments/footer::footer"></footer>
</body>
</html>